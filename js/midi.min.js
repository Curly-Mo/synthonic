function midiMessageReceived(a){var d=a.data[0]>>4,b=a.data[1],c=a.data[2];9!=(a.data[0]&15)&&(8==d||9==d&&0==c?noteOff(b):9==d?noteOn(b,c/127):11!=d&&14!=d&&10!=d&&console.log(""+a.data[0]+" "+a.data[1]+" "+a.data[2]))}var selectMIDI=null,midiAccess=null,midiIn=null;
function selectMIDIIn(a){midiIn&&(midiIn.onmidimessage=null);var d=a.target[a.target.selectedIndex].value;if(midiIn="function"==typeof midiAccess.inputs?midiAccess.inputs()[a.target.selectedIndex]:midiAccess.inputs.get(d))midiIn.onmidimessage=midiMessageReceived}
function populateMIDIInSelect(){selectMIDI.options.length=0;midiIn&&"disconnected"==midiIn.state&&(midiIn=null);for(var a=null,d=midiAccess.inputs.values(),b=d.next();b&&!b.done;b=d.next()){b=b.value;a||(a=b);var c=b.name.toString(),c=!midiIn&&(-1!=c.indexOf("MPK")||-1!=c.indexOf("Keyboard")||-1!=c.indexOf("keyboard")||-1!=c.indexOf("KEYBOARD"));midiIn&&midiIn==b&&(c=!0);selectMIDI.appendChild(new Option(b.name,b.id,c,c));c&&(midiIn=b,midiIn.onmidimessage=midiMessageReceived)}!midiIn&&(midiIn=a)&&
(midiIn.onmidimessage=midiMessageReceived)}function midiConnectionStateChange(a){console.log("connection: "+a.port.name+" "+a.port.connection+" "+a.port.state);populateMIDIInSelect()}function onMIDIStarted(a){midiAccess=a;selectMIDI=document.getElementById("midiIn");a.onstatechange=midiConnectionStateChange;populateMIDIInSelect();selectMIDI.onchange=selectMIDIIn}function onMIDISystemError(a){console.log("MIDI not initialized - error encountered:"+a.code)}
window.addEventListener("load",function(){navigator.requestMIDIAccess&&navigator.requestMIDIAccess().then(onMIDIStarted,onMIDISystemError)});
